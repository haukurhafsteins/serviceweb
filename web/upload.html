<!DOCTYPE html>
<html>

<head>
    <title>File Upload</title>
</head>

<body>
    <h2>Upload File to Disk</h2>
    <form method="POST" action="/upload" enctype="multipart/form-data" id="upload_form">
        <input type="file" name="update" multiple required>
        <input type="text" name="destination" placeholder="Enter destination path">
        <input type="submit" value="Upload">
    </form>
    <div id="prg">Progress: 0%</div>
    <script>
        document.getElementById('upload_form').addEventListener('submit', function (evt) {
            evt.preventDefault(); // Prevent normal form submission
    
            var fileInput = document.querySelector('input[type="file"]');
            var files = fileInput.files;
            var destinationInput = document.querySelector('input[name="destination"]');
            var destination = encodeURIComponent(destinationInput.value); // Encode the destination path
            var prg = document.getElementById('prg');
            var formData = new FormData();
            formData.append('destination', destination); // Append destination path only once
    
            var uploadFile = function (index) {
                if (index >= files.length) {
                    prg.innerHTML = 'All uploads complete!';
                    return; // Stop when all files are uploaded
                }
    
                var file = files[index];
                var filename = encodeURIComponent(file.name);
                var actionURL = '/upload?destination=' + destination + '&filename=' + filename;
    
                var xhr = new XMLHttpRequest();
                xhr.open('POST', actionURL, true);
    
                xhr.upload.addEventListener('progress', function (evt) {
                    if (evt.lengthComputable) {
                        var per = (evt.loaded / evt.total) * 100;
                        prg.innerHTML = 'Progress: ' + per.toFixed(2) + '% (File ' + (index + 1) + ' of ' + files.length + ')';
                    }
                }, false);
    
                xhr.upload.addEventListener('load', function (evt) {
                    prg.innerHTML = 'Upload of file ' + (index + 1) + ' complete!';
                    uploadFile(index + 1); // Upload the next file
                }, false);
    
                xhr.upload.addEventListener('error', function (evt) {
                    prg.innerHTML = 'Error uploading file ' + (index + 1);
                }, false);
    
                formData.set('update', file); // Set or replace the file in formData
                xhr.send(formData); // Send formData with the current file
            };
    
            uploadFile(0); // Start uploading the first file
        });
    </script>
    
    
</body>

</html>
